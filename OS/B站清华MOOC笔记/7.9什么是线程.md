# 7.9什么是线程

### 线程 Thread

* 线程是进程中的一条执行流程。
* 重新理解进程：
    * 进程由两部分组成：资源管理与线程。
    * 从资源组合的角度：进程将一组相关的资源组合起来，构成一个资源平台（环境），包括地址空间（代码段，数据段），打开的文件，内存等各种资源。进程的主要功能就是管理资源。
    * 从运行的角度：进程的执行功能交给一个或多个线程完成。
* 同一个进程的线程共享该进程的 代码段，数据段，内存，文件等资源。
* 线程的组织结构：线程有自己的线程控制块 TCB
    * TCB只负责管理执行流程相关的信息。
    * TCB包括 程序计数器，状态，堆栈，寄存器信息。这是每个进程独立的
* 线程 = 进程 - 资源管理
* 线程的优点：
    * 一个进程中可以同时存在多个线程
    * 各个线程可以并发地执行
    * 各个线程之间可以共享地址空间，文件等资源
* 进程的缺点：
    * 一个线程的崩溃，会导致该进程中别的线程崩溃，整个进程也就死亡了。线程的安全性比较差。
* 进程与线程的选择：
    * 追求高性能的计算，且执行流程比较类似时，一般使用线程。比如天气预报的计算。
    * 性能不是瓶颈，追求安全性时。比如浏览器的实现，现在就是多进程的
* 线程需要的资源：
    * 单线程，进程中只有一个控制流，所有资源都是它的
    * 多线程：多个控制流
        * 共享的资源：代码段，数据段，文件资源，网络资源
        * 独占的资源：与控制执行相关。计数器，寄存器，堆栈

### 进程与线程的比较

* 进程是资源分配的单位，线程是CPU调度的单位。
* 进程是一个完整的资源平台，而线程只独享一部分必须的资源。
* 线程如进程一样，三种基本状态：就绪，阻塞，执行。状态之间可以互相转换。其实进程的状态就是体现在线程状态。
* 线程可以减少并发执行的空间和时间开销：
    * 线程的创建时间比进程短。因为进程创建过程中要创建内存管理信息，文件管理信息。线程则可以直接使用进程创建好的信息。
    * 同理，线程的终止时间比进程短，因为不需要线程进程资源的释放。
    * 同一进程内的线程之间切换比较快。因为同一个进程的线程，共用地址空间，不涉及页表的转换。而进程之间的切换，需要切换页表（开销大），会使缓存，硬件的信息无效，需要重新加载。
    * 同一进程的线程共享内存和文件资源，可以直接进行不通过内核的通信。