# 7.7进程挂起

### 原因

* 合理且充分地利用系统资源。
* 进程在挂起状态时，意味着进程没有占用内存空间。处于挂起状态的进程，其映像在外存中。

### 挂起状态

* 阻塞挂起状态（Blocked-suspend）：进程在外存中并等待某事件的出现。
* 就绪挂起状态（Ready-suspend）：进程在外存中，但只要进入内存，即可运行，成为就绪态

### 与挂起相关的状态转换

* 挂起：把一个进程从内存中放入外存中：
    * 阻塞到阻塞挂起：内存空间不够用时，可能会将阻塞状态的进程由内存放入外存，以提交新进程或者运行就绪进程。
    * 就绪到就绪挂起：同理。
        * 一般来说就绪状态的进程优先级大于阻塞状态的进程，所以一般会先将阻塞状态挂起
        * 但是也有高优先级的阻塞状态（OS认为一旦事件就绪，立马唤醒），这个时候会先将低优先级的就绪进程挂起。
    * 运行到就绪挂起：对抢先式分时系统，当有高优先级的阻塞挂起进行因事件出现成为就绪挂起进程，系统可能会把运行进程转变为就绪挂起进程。
* 在外村时的状态转换：
    * 阻塞挂起到就绪挂起：相关事件出现，阻塞被唤起，但仍然在外存中。
* 解挂/激活（activate）：把一个进程从外存转化到内存：
    * 就绪挂起到就绪：没有就绪进程或者挂起就绪进程优先级高于就绪进程。
    * 阻塞挂起到阻塞：当一个进程释放足够内存时，系统会将一个高优先级阻塞挂起进程转换为阻塞进程。

### OS通过PCB和定义的进程状态管理PCB

* OS选择某个进程占用CPU执行；选择某个进程如何进行状态转换。
* 状态队列：
    * 由OS维护一组队列，用来表示系统当中所有进程的当前状态
    * 不同状态分别用不同的队列来表示（就绪队列，各种类型的阻塞队列）
    * 每个进程的PCB都根据它的状态加入相应的状态队列， 一旦状态发生改变，它的PCB就从一个队列中出来加入到另外一个状态队列。
    * 状态队列也分优先级，比如多个就绪队列，优先级不同。
    * 阻塞队列按照等待事件也分为多个队列。