# 2.2操作系统的中断，异常和系统调用

[toc]

### 中断的处理

* 硬件：设置中断标记（CPU初始化）
    * 将内部，外部事件设置中断标记
    * 中断事件的ID
* 软件：
    * 保存当前的处理状态
    * 中断服务程序处理
    * 清除中断标记
    * 恢复之前保存的处理状态

### 异常的处理

* 保存现场
* 异常处理，根据异常编号
    * 杀死产生了异常的程序
    * 重新执行异常的那条指令（操作系统判断是OS的服务问题时）
* 恢复现场

### 系统调用的处理

* 程序访问主要是通过高层次的API接口而不是直接进行系统调用
* 用户态到内核态的转换。用户态：应用程序执行时CPU处于的特权级状态，低，不能I/O及特殊的机械指令。内核态：OS运行时CPU处于的状态，权限高，可以执行所有指令。
* 操作系统可以对应用程序发出的参数及ID号坐标识，识别之后完成具体的服务。
* 函数调用：在一个栈空间完成传参与返回。系统也有自己的栈，要切换栈。

###  跨越操作系统边界的开销

* 在执行时间上的开销超过程序调用
* 开销
    * 建立中断/异常/系统调用号与对应服务映射关系
    * 建立内核堆栈
    * 验证应用程序的参数
    * COPY数据的开销：内核态映射到用户态的地址空间，更新页面映射权限。
    * 内核态独立地址空间