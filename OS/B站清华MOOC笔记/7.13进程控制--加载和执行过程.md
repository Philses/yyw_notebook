# 7.13进程控制--加载和执行过程

### exec（）的作用

* 允许一个进程加载一个不同的程序并且在main开始执行
* 它允许一个进程指定参数的数量和它的字符串参数数组
* 如果调用成功，这个进程会执行与创建它的父进程不一样的程序。
* 调用之后，代码，栈（stack）和堆（heap）会重写

### fork（）的开销

* 简单实现：
    * 对子进程分配内存
    * 复制父进程的内存和CPU寄存器到子进程中，大量的拷贝
    * 开销很昂贵
* 机会所有情况，调用fork（）后都会调用exec（）
    * 那么，fork（）中复制父进程的内存与CPU寄存器就没有意义。（因为exec（）会重写）
    * 子进程可能关闭打开的文件及链接
    * 开销很高
    * 所以将二者结合调用来改进？
* vfork（）
    * 一个创建进程的系统调用，不创建一个同样的内存映像
    * 子进程几乎立即调用 exec（）
    * 现在不再使用这个技术
* 现在采用 Copy on Write（COW）技术：写时复制
    * 写的时候再进行复制。使得fork（）改进得很高校
    * 在fork（）时不进行同样的内存映像的创建，只复制进程的元数据（页表）
    * 当父进程或者子进程对该页进行写操作时，才进行页的复制。
        * 因为只读没有必要复制页