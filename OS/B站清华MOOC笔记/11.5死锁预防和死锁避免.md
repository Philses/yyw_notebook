# 11.5死锁预防和死锁避免

### 死锁预防：让死锁不会出现

* 使死锁产生的四个必要条件其一不满足
* 互斥：使资源从互斥变为不互斥，可能会出现互斥不满足带来进程执行结果的不确定性（不可接受）
* 占用并等待：
    * 打破方式：进程要么获取所有资源，要么一个资源都不获取
    * 资源利用率太低，可能导致饥饿发生。
* 无抢占：
    * 打破方式：请求某个资源时，占用该资源的进程被杀死，于是就可以将资源抢占
* 循环等待：
    * 打破方式：对所有资源类型进行排序，要求每个进程按照资源的顺序进行申请
    * 要对资源类型排序，也会出现资源利用率低
    * 在嵌入式系统中比较多，因为资源类型有限。

### 死锁避免

* 最简单有效的模式：要求每个进程声明它需要的每个类型资源的最大数目。资源的分配状态是限定提供与分配的资源数量，和进程的最大需求。
* 死锁避免算法**动态检查**资源分配状态，以确保不会出现一个环形等待状态。判断如果分配之后会出现环形等待状态，就不会进行这样的资源分配。
    * 也就是说当一个进程请求可用资源时，系统必须判断分配后是否可以使系统处于安全状态
    * 安全状态是指：对于每个进程，存在安全序列
    * 安全序列是指：[P1, P2, …… ,Pn]按结束时间顺序排列的进程序列（P1 在 P2前结束）。对于每个Pi，Pi需要的资源能够由当前可用资源+[P1, P2, ……P(i-1)]这些进程释放的资源来满足。按这样的设定，每个进程需要的资源都可以得到满足，都可以顺利执行。
    * 安全状态一定没有死锁。
    * 死锁时肯定是不安全状态；但是不安全状态不一定会发生死锁。