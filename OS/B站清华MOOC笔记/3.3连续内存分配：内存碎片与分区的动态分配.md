# 3.3连续内存分配：内存碎片与分区的动态分配

[toc]

### 内存碎片问题

* 内存碎片的定义：空闲不能被利用的内存
* 外部碎片：在分配单元之间的未使用的内存
* 内部碎片：分配单元中的未使用的内存 （程序分配得到的内存但没有使用）

### 简单的内存管理方法：

* 当一个程序准许运行在内存中时，分配一个连续的区间
* 分配一个连续的内存区间给运行的程序以访问数据

### 分区的动态分配

##### 第一适配

* 利用第一个可用空闲块
* 需求：
    * 按地址排序的空闲块列表
    * 分配需要找到一个合适的分区
    * 重分配需要检查，是否自由分区能合并于相邻的空闲分区
* 优势：
    * 简单
    * 易于产生更大空闲块（地址空间的结尾处）
* 劣势：
    * 外部碎片
    * 不确定性

##### 最佳适配

* 利用可以满足分配请求的最小的可用空闲块，避免分割大空闲块，最小化外部碎片。
* 需求：
    * 按尺寸排序的空闲列表块
    * 分配需要找到一个合适的分区
    * 重分配需要检查，是否自由分区能合并于相邻的空闲分区
* 优势：
    * 当大部分分配是小尺寸时很有效
* 劣势：
    * 容易产生很多没用的微小碎片
    * 重分配慢

##### 最差适配

* 利用可以满足分配请求的最大的可用空闲块，为了避免产生太多微小的碎片
* 需求：
    * 按尺寸排序的空闲列表块
    * 分配很快
    * 重分配需要检查，是否自由分区能合并于相邻的空闲分区
* 优势：如果分配中等尺寸效果最好
* 劣势：
    * 重分配慢
    * 容易破碎大的空闲块以至于大分区无法被分配